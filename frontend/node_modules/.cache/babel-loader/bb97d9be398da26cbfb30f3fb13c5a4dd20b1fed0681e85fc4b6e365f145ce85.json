{"ast":null,"code":"import { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'UserProfile',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n    const form = ref(null);\n    const valid = ref(false);\n    const loading = computed(() => store.state.loading);\n\n    // 表单数据\n    const formData = ref({\n      name: '',\n      gender: '',\n      grade: '',\n      major: '',\n      cet4_taken: null,\n      cet4_score: '',\n      cet4_reading_score: '',\n      cet6_taken: null,\n      cet6_score: '',\n      cet6_reading_score: '',\n      exam_name: '',\n      total_score: '',\n      reading_score: ''\n    });\n\n    // 表单验证规则\n    const nameRules = [v => !!v || '姓名不能为空', v => v && v.length <= 20 || '姓名不能超过20个字符'];\n\n    // 提交表单\n    const submitForm = async () => {\n      if (!valid.value) return;\n      const userData = {\n        name: formData.value.name,\n        grade: formData.value.grade,\n        major: formData.value.major,\n        gender: formData.value.gender,\n        cet4_taken: formData.value.cet4_taken,\n        cet4_score: formData.value.cet4_score,\n        cet4_reading_score: formData.value.cet4_reading_score,\n        cet6_taken: formData.value.cet6_taken,\n        cet6_score: formData.value.cet6_score,\n        cet6_reading_score: formData.value.cet6_reading_score,\n        other_scores: formData.value.exam_name ? \"是\" : \"否\",\n        exam_name: formData.value.exam_name,\n        total_score: formData.value.total_score,\n        reading_score: formData.value.reading_score\n      };\n      const success = await store.dispatch('createUserProfile', userData);\n      if (success) {\n        // 导航到前测页面\n        router.push({\n          name: 'PreTest',\n          params: {\n            id: 1\n          }\n        });\n      }\n    };\n\n    // 组件挂载时，检查是否有用户名，有则预填表单\n    onMounted(async () => {\n      const userName = store.state.userName;\n      if (userName) {\n        formData.value.name = userName;\n\n        // 获取用户信息\n        await store.dispatch('fetchUserProfile');\n        const userProfile = store.state.userProfile;\n\n        // 如果有用户信息，预填表单\n        if (userProfile) {\n          formData.value.gender = userProfile.gender || '';\n          formData.value.grade = userProfile.grade || '';\n          formData.value.major = userProfile.major || '';\n          formData.value.cet4_taken = userProfile['Have you taken the CET-4 exam:'] || null;\n          formData.value.cet4_score = userProfile['CET-4 score'] || '';\n          formData.value.cet4_reading_score = userProfile['CET-4 reading score'] || '';\n          formData.value.cet6_taken = userProfile['Have you taken the CET-6 exam'] || null;\n          formData.value.cet6_score = userProfile['CET-6 score'] || '';\n          formData.value.cet6_reading_score = userProfile['CET-6 reading score'] || '';\n          formData.value.exam_name = userProfile['Exam name'] || '';\n          formData.value.total_score = userProfile['Total score'] || '';\n          formData.value.reading_score = userProfile['Reading score'] || '';\n        }\n      }\n    });\n    return {\n      form,\n      valid,\n      loading,\n      formData,\n      nameRules,\n      submitForm\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","useRouter","name","setup","store","router","form","valid","loading","state","formData","gender","grade","major","cet4_taken","cet4_score","cet4_reading_score","cet6_taken","cet6_score","cet6_reading_score","exam_name","total_score","reading_score","nameRules","v","length","submitForm","value","userData","other_scores","success","dispatch","push","params","id","userName","userProfile"],"sources":["D:\\PycharmProjects\\perss_v4\\frontend\\src\\views\\planning\\UserProfile.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-profile\">\r\n    <v-card>\r\n      <v-card-title class=\"text-h5 primary--text\">\r\n        <v-icon start icon=\"mdi-account-outline\"></v-icon>\r\n        用户信息采集\r\n      </v-card-title>\r\n\r\n      <v-card-text>\r\n        <p class=\"text-body-1 mb-4\">\r\n          为了提供个性化的英语阅读学习支持，请填写以下信息，帮助我们更好地了解您的英语学习背景和需求。\r\n        </p>\r\n\r\n        <v-form ref=\"form\" v-model=\"valid\" @submit.prevent=\"submitForm\">\r\n          <v-container>\r\n            <v-row>\r\n              <!-- 基本信息 -->\r\n              <v-col cols=\"12\">\r\n                <h3 class=\"text-subtitle-1 mb-2\">基本信息</h3>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-text-field\r\n                  v-model=\"formData.name\"\r\n                  label=\"姓名\"\r\n                  variant=\"outlined\"\r\n                  required\r\n                  :rules=\"nameRules\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-select\r\n                  v-model=\"formData.gender\"\r\n                  label=\"性别\"\r\n                  variant=\"outlined\"\r\n                  :items=\"['男', '女', '其他']\"\r\n                ></v-select>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-text-field\r\n                  v-model=\"formData.grade\"\r\n                  label=\"年级\"\r\n                  variant=\"outlined\"\r\n                  hint=\"例如：大一、大二、硕士一年级等\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-text-field\r\n                  v-model=\"formData.major\"\r\n                  label=\"专业\"\r\n                  variant=\"outlined\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <!-- CET-4相关信息 -->\r\n              <v-col cols=\"12\">\r\n                <h3 class=\"text-subtitle-1 mb-2\">英语四级(CET-4)信息</h3>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-radio-group\r\n                  v-model=\"formData.cet4_taken\"\r\n                  label=\"是否参加过英语四级考试\"\r\n                  inline\r\n                >\r\n                  <v-radio value=\"是\" label=\"是\"></v-radio>\r\n                  <v-radio value=\"否\" label=\"否\"></v-radio>\r\n                </v-radio-group>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\" v-if=\"formData.cet4_taken === '是'\">\r\n                <v-text-field\r\n                  v-model=\"formData.cet4_score\"\r\n                  label=\"英语四级总分\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  max=\"710\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\" v-if=\"formData.cet4_taken === '是'\">\r\n                <v-text-field\r\n                  v-model=\"formData.cet4_reading_score\"\r\n                  label=\"英语四级阅读分数\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  max=\"249\"\r\n                  hint=\"四级阅读满分为249分\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <!-- CET-6相关信息 -->\r\n              <v-col cols=\"12\">\r\n                <h3 class=\"text-subtitle-1 mb-2\">英语六级(CET-6)信息</h3>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\">\r\n                <v-radio-group\r\n                  v-model=\"formData.cet6_taken\"\r\n                  label=\"是否参加过英语六级考试\"\r\n                  inline\r\n                >\r\n                  <v-radio value=\"是\" label=\"是\"></v-radio>\r\n                  <v-radio value=\"否\" label=\"否\"></v-radio>\r\n                </v-radio-group>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\" v-if=\"formData.cet6_taken === '是'\">\r\n                <v-text-field\r\n                  v-model=\"formData.cet6_score\"\r\n                  label=\"英语六级总分\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  max=\"710\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"6\" v-if=\"formData.cet6_taken === '是'\">\r\n                <v-text-field\r\n                  v-model=\"formData.cet6_reading_score\"\r\n                  label=\"英语六级阅读分数\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  max=\"249\"\r\n                  hint=\"六级阅读满分为249分\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <!-- 其他英语考试信息 -->\r\n              <v-col cols=\"12\">\r\n                <h3 class=\"text-subtitle-1 mb-2\">其他英语考试信息（选填）</h3>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"4\">\r\n                <v-text-field\r\n                  v-model=\"formData.exam_name\"\r\n                  label=\"考试名称\"\r\n                  variant=\"outlined\"\r\n                  hint=\"例如：托福、雅思、专四、专八等\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"4\">\r\n                <v-text-field\r\n                  v-model=\"formData.total_score\"\r\n                  label=\"总分\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                ></v-text-field>\r\n              </v-col>\r\n\r\n              <v-col cols=\"12\" md=\"4\">\r\n                <v-text-field\r\n                  v-model=\"formData.reading_score\"\r\n                  label=\"阅读分数\"\r\n                  variant=\"outlined\"\r\n                  type=\"number\"\r\n                ></v-text-field>\r\n              </v-col>\r\n            </v-row>\r\n          </v-container>\r\n        </v-form>\r\n      </v-card-text>\r\n\r\n      <v-divider></v-divider>\r\n\r\n      <v-card-actions>\r\n        <v-spacer></v-spacer>\r\n        <v-btn\r\n          color=\"primary\"\r\n          variant=\"flat\"\r\n          :loading=\"loading\"\r\n          :disabled=\"!valid\"\r\n          @click=\"submitForm\"\r\n        >\r\n          保存并继续\r\n          <v-icon end icon=\"mdi-arrow-right\"></v-icon>\r\n        </v-btn>\r\n      </v-card-actions>\r\n    </v-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useRouter } from 'vue-router';\r\n\r\nexport default {\r\n  name: 'UserProfile',\r\n\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n    const form = ref(null);\r\n    const valid = ref(false);\r\n    const loading = computed(() => store.state.loading);\r\n\r\n    // 表单数据\r\n    const formData = ref({\r\n      name: '',\r\n      gender: '',\r\n      grade: '',\r\n      major: '',\r\n      cet4_taken: null,\r\n      cet4_score: '',\r\n      cet4_reading_score: '',\r\n      cet6_taken: null,\r\n      cet6_score: '',\r\n      cet6_reading_score: '',\r\n      exam_name: '',\r\n      total_score: '',\r\n      reading_score: ''\r\n    });\r\n\r\n    // 表单验证规则\r\n    const nameRules = [\r\n      v => !!v || '姓名不能为空',\r\n      v => (v && v.length <= 20) || '姓名不能超过20个字符'\r\n    ];\r\n\r\n    // 提交表单\r\n    const submitForm = async () => {\r\n      if (!valid.value) return;\r\n\r\n      const userData = {\r\n        name: formData.value.name,\r\n        grade: formData.value.grade,\r\n        major: formData.value.major,\r\n        gender: formData.value.gender,\r\n        cet4_taken: formData.value.cet4_taken,\r\n        cet4_score: formData.value.cet4_score,\r\n        cet4_reading_score: formData.value.cet4_reading_score,\r\n        cet6_taken: formData.value.cet6_taken,\r\n        cet6_score: formData.value.cet6_score,\r\n        cet6_reading_score: formData.value.cet6_reading_score,\r\n        other_scores: formData.value.exam_name ? \"是\" : \"否\",\r\n        exam_name: formData.value.exam_name,\r\n        total_score: formData.value.total_score,\r\n        reading_score: formData.value.reading_score\r\n      };\r\n\r\n      const success = await store.dispatch('createUserProfile', userData);\r\n\r\n      if (success) {\r\n        // 导航到前测页面\r\n        router.push({ name: 'PreTest', params: { id: 1 } });\r\n      }\r\n    };\r\n\r\n    // 组件挂载时，检查是否有用户名，有则预填表单\r\n    onMounted(async () => {\r\n      const userName = store.state.userName;\r\n      if (userName) {\r\n        formData.value.name = userName;\r\n\r\n        // 获取用户信息\r\n        await store.dispatch('fetchUserProfile');\r\n        const userProfile = store.state.userProfile;\r\n\r\n        // 如果有用户信息，预填表单\r\n        if (userProfile) {\r\n          formData.value.gender = userProfile.gender || '';\r\n          formData.value.grade = userProfile.grade || '';\r\n          formData.value.major = userProfile.major || '';\r\n          formData.value.cet4_taken = userProfile['Have you taken the CET-4 exam:'] || null;\r\n          formData.value.cet4_score = userProfile['CET-4 score'] || '';\r\n          formData.value.cet4_reading_score = userProfile['CET-4 reading score'] || '';\r\n          formData.value.cet6_taken = userProfile['Have you taken the CET-6 exam'] || null;\r\n          formData.value.cet6_score = userProfile['CET-6 score'] || '';\r\n          formData.value.cet6_reading_score = userProfile['CET-6 reading score'] || '';\r\n          formData.value.exam_name = userProfile['Exam name'] || '';\r\n          formData.value.total_score = userProfile['Total score'] || '';\r\n          formData.value.reading_score = userProfile['Reading score'] || '';\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      form,\r\n      valid,\r\n      loading,\r\n      formData,\r\n      nameRules,\r\n      submitForm\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.user-profile {\r\n  max-width: 100%;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}