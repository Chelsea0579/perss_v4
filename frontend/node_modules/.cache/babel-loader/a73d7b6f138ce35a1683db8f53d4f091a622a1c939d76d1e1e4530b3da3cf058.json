{"ast":null,"code":"import { computed, ref, onMounted, watch } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nexport default {\n  name: 'SelfRate',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n\n    // 自评量表数据\n    const selfRateItems = computed(() => store.state.selfRateItems);\n    const answers = ref([]);\n    const completed = ref(false);\n\n    // 分页\n    const itemsPerPage = 10;\n    const currentPage = ref(1);\n\n    // 计算总页数\n    const totalPages = computed(() => {\n      return Math.ceil(selfRateItems.value.length / itemsPerPage);\n    });\n\n    // 计算当前页的项目\n    const currentItems = computed(() => {\n      const start = (currentPage.value - 1) * itemsPerPage;\n      const end = start + itemsPerPage;\n      return selfRateItems.value.slice(start, end);\n    });\n\n    // 当前页起始索引\n    const startIndex = computed(() => {\n      return (currentPage.value - 1) * itemsPerPage;\n    });\n\n    // 获取列标题\n    const getColumnHeader = index => {\n      const headers = {\n        1: '完全不符合',\n        2: '有些不符合',\n        3: '有些符合',\n        4: '比较符合',\n        5: '非常符合'\n      };\n      return headers[index] || '';\n    };\n\n    // 计算未回答的问题数量\n    const unansweredCount = computed(() => {\n      return answers.value.filter(a => !a).length;\n    });\n\n    // 是否有未回答的问题\n    const hasUnansweredQuestions = computed(() => {\n      return unansweredCount.value > 0;\n    });\n\n    // 重置表单\n    const resetForm = () => {\n      answers.value = new Array(selfRateItems.value.length).fill(null);\n    };\n\n    // 提交表单\n    const submitForm = () => {\n      if (hasUnansweredQuestions.value) {\n        // 如果有未回答的问题，切换到第一个未回答的问题所在页\n        const firstUnansweredIndex = answers.value.findIndex(a => !a);\n        if (firstUnansweredIndex !== -1) {\n          currentPage.value = Math.floor(firstUnansweredIndex / itemsPerPage) + 1;\n        }\n        return;\n      }\n\n      // 标记为已完成\n      completed.value = true;\n\n      // 导航到用户画像页面\n      router.push({\n        name: 'UserProfile'\n      });\n    };\n\n    // 加载自评量表\n    const loadSelfRateItems = async () => {\n      await store.dispatch('fetchSelfRateItems');\n\n      // 初始化答案数组\n      if (answers.value.length === 0) {\n        answers.value = new Array(selfRateItems.value.length).fill(null);\n      }\n    };\n\n    // 组件挂载时加载数据\n    onMounted(() => {\n      loadSelfRateItems();\n    });\n    return {\n      selfRateItems,\n      answers,\n      completed,\n      currentPage,\n      totalPages,\n      currentItems,\n      startIndex,\n      unansweredCount,\n      hasUnansweredQuestions,\n      loading: computed(() => store.state.loading),\n      getColumnHeader,\n      resetForm,\n      submitForm\n    };\n  }\n};","map":{"version":3,"names":["computed","ref","onMounted","watch","useStore","useRouter","name","setup","store","router","selfRateItems","state","answers","completed","itemsPerPage","currentPage","totalPages","Math","ceil","value","length","currentItems","start","end","slice","startIndex","getColumnHeader","index","headers","unansweredCount","filter","a","hasUnansweredQuestions","resetForm","Array","fill","submitForm","firstUnansweredIndex","findIndex","floor","push","loadSelfRateItems","dispatch","loading"],"sources":["D:\\PycharmProjects\\perss_v4\\frontend\\src\\views\\planning\\SelfRate.vue"],"sourcesContent":["<template>\r\n  <div class=\"self-rate\">\r\n    <v-card>\r\n      <v-card-title class=\"text-h5 primary--text\">\r\n        <v-icon start icon=\"mdi-checkbox-marked-circle-outline\"></v-icon>\r\n        英语阅读能力自评\r\n      </v-card-title>\r\n\r\n      <v-card-text>\r\n        <p class=\"text-body-1 mb-4\">\r\n          请根据您的实际情况，为每项描述选择最符合的选项。您的选择将帮助我们更好地了解您的英语阅读水平和需求。\r\n        </p>\r\n\r\n        <div v-if=\"selfRateItems.length === 0\" class=\"text-center py-4\">\r\n          <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\r\n          <div class=\"mt-2\">加载中...</div>\r\n        </div>\r\n\r\n        <template v-else>\r\n          <v-table>\r\n            <thead>\r\n              <tr>\r\n                <th>序号</th>\r\n                <th>描述</th>\r\n                <th class=\"text-center\" v-for=\"i in 5\" :key=\"`header-${i}`\">\r\n                  {{ getColumnHeader(i) }}\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr v-for=\"(item, index) in currentItems\" :key=\"`item-${item.id}`\">\r\n                <td>{{ startIndex + index + 1 }}</td>\r\n                <td>{{ item.内容 }}</td>\r\n                <td class=\"text-center\" v-for=\"i in 5\" :key=\"`option-${i}`\">\r\n                  <v-radio-group\r\n                    v-model=\"answers[startIndex + index]\"\r\n                    inline\r\n                    hide-details\r\n                    class=\"ma-0 pa-0 justify-center\"\r\n                  >\r\n                    <v-radio :value=\"i\" :disabled=\"completed\"></v-radio>\r\n                  </v-radio-group>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </v-table>\r\n\r\n          <div class=\"text-center mt-4\">\r\n            <v-pagination\r\n              v-model=\"currentPage\"\r\n              :length=\"totalPages\"\r\n              :total-visible=\"7\"\r\n            ></v-pagination>\r\n          </div>\r\n\r\n          <v-alert\r\n            v-if=\"hasUnansweredQuestions\"\r\n            type=\"warning\"\r\n            variant=\"tonal\"\r\n            border=\"start\"\r\n            icon=\"mdi-alert-outline\"\r\n            class=\"mt-4\"\r\n          >\r\n            您还有 {{ unansweredCount }} 个项目未评估。请确保所有项目都已选择后再继续。\r\n          </v-alert>\r\n        </template>\r\n      </v-card-text>\r\n\r\n      <v-divider></v-divider>\r\n\r\n      <v-card-actions>\r\n        <v-btn\r\n          v-if=\"!completed\"\r\n          variant=\"outlined\"\r\n          color=\"error\"\r\n          @click=\"resetForm\"\r\n        >\r\n          重置\r\n        </v-btn>\r\n\r\n        <v-spacer></v-spacer>\r\n\r\n        <v-btn\r\n          color=\"primary\"\r\n          variant=\"flat\"\r\n          :disabled=\"hasUnansweredQuestions\"\r\n          :loading=\"loading\"\r\n          @click=\"submitForm\"\r\n        >\r\n          继续\r\n          <v-icon end icon=\"mdi-arrow-right\"></v-icon>\r\n        </v-btn>\r\n      </v-card-actions>\r\n    </v-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, ref, onMounted, watch } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useRouter } from 'vue-router';\r\n\r\nexport default {\r\n  name: 'SelfRate',\r\n\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n\r\n    // 自评量表数据\r\n    const selfRateItems = computed(() => store.state.selfRateItems);\r\n    const answers = ref([]);\r\n    const completed = ref(false);\r\n\r\n    // 分页\r\n    const itemsPerPage = 10;\r\n    const currentPage = ref(1);\r\n\r\n    // 计算总页数\r\n    const totalPages = computed(() => {\r\n      return Math.ceil(selfRateItems.value.length / itemsPerPage);\r\n    });\r\n\r\n    // 计算当前页的项目\r\n    const currentItems = computed(() => {\r\n      const start = (currentPage.value - 1) * itemsPerPage;\r\n      const end = start + itemsPerPage;\r\n      return selfRateItems.value.slice(start, end);\r\n    });\r\n\r\n    // 当前页起始索引\r\n    const startIndex = computed(() => {\r\n      return (currentPage.value - 1) * itemsPerPage;\r\n    });\r\n\r\n    // 获取列标题\r\n    const getColumnHeader = (index) => {\r\n      const headers = {\r\n        1: '完全不符合',\r\n        2: '有些不符合',\r\n        3: '有些符合',\r\n        4: '比较符合',\r\n        5: '非常符合'\r\n      };\r\n\r\n      return headers[index] || '';\r\n    };\r\n\r\n    // 计算未回答的问题数量\r\n    const unansweredCount = computed(() => {\r\n      return answers.value.filter(a => !a).length;\r\n    });\r\n\r\n    // 是否有未回答的问题\r\n    const hasUnansweredQuestions = computed(() => {\r\n      return unansweredCount.value > 0;\r\n    });\r\n\r\n    // 重置表单\r\n    const resetForm = () => {\r\n      answers.value = new Array(selfRateItems.value.length).fill(null);\r\n    };\r\n\r\n    // 提交表单\r\n    const submitForm = () => {\r\n      if (hasUnansweredQuestions.value) {\r\n        // 如果有未回答的问题，切换到第一个未回答的问题所在页\r\n        const firstUnansweredIndex = answers.value.findIndex(a => !a);\r\n        if (firstUnansweredIndex !== -1) {\r\n          currentPage.value = Math.floor(firstUnansweredIndex / itemsPerPage) + 1;\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 标记为已完成\r\n      completed.value = true;\r\n\r\n      // 导航到用户画像页面\r\n      router.push({ name: 'UserProfile' });\r\n    };\r\n\r\n    // 加载自评量表\r\n    const loadSelfRateItems = async () => {\r\n      await store.dispatch('fetchSelfRateItems');\r\n\r\n      // 初始化答案数组\r\n      if (answers.value.length === 0) {\r\n        answers.value = new Array(selfRateItems.value.length).fill(null);\r\n      }\r\n    };\r\n\r\n    // 组件挂载时加载数据\r\n    onMounted(() => {\r\n      loadSelfRateItems();\r\n    });\r\n\r\n    return {\r\n      selfRateItems,\r\n      answers,\r\n      completed,\r\n      currentPage,\r\n      totalPages,\r\n      currentItems,\r\n      startIndex,\r\n      unansweredCount,\r\n      hasUnansweredQuestions,\r\n      loading: computed(() => store.state.loading),\r\n      getColumnHeader,\r\n      resetForm,\r\n      submitForm\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.self-rate {\r\n  max-width: 100%;\r\n}\r\n\r\n.v-table {\r\n  border: 1px solid #e0e0e0;\r\n}\r\n\r\n.v-table th, .v-table td {\r\n  padding: 8px;\r\n  vertical-align: middle;\r\n}\r\n\r\n.v-table th:nth-child(2), .v-table td:nth-child(2) {\r\n  text-align: left;\r\n  min-width: 300px;\r\n}\r\n\r\n.v-table th:not(:nth-child(2)), .v-table td:not(:nth-child(2)) {\r\n  width: 80px;\r\n}\r\n</style>"],"mappings":"AAkGA,SAASA,QAAQ,EAAEC,GAAG,EAAEC,SAAS,EAAEC,KAAI,QAAS,KAAK;AACrD,SAASC,QAAO,QAAS,MAAM;AAC/B,SAASC,SAAQ,QAAS,YAAY;AAEtC,eAAe;EACbC,IAAI,EAAE,UAAU;EAEhBC,KAAKA,CAAA,EAAG;IACN,MAAMC,KAAI,GAAIJ,QAAQ,CAAC,CAAC;IACxB,MAAMK,MAAK,GAAIJ,SAAS,CAAC,CAAC;;IAE1B;IACA,MAAMK,aAAY,GAAIV,QAAQ,CAAC,MAAMQ,KAAK,CAACG,KAAK,CAACD,aAAa,CAAC;IAC/D,MAAME,OAAM,GAAIX,GAAG,CAAC,EAAE,CAAC;IACvB,MAAMY,SAAQ,GAAIZ,GAAG,CAAC,KAAK,CAAC;;IAE5B;IACA,MAAMa,YAAW,GAAI,EAAE;IACvB,MAAMC,WAAU,GAAId,GAAG,CAAC,CAAC,CAAC;;IAE1B;IACA,MAAMe,UAAS,GAAIhB,QAAQ,CAAC,MAAM;MAChC,OAAOiB,IAAI,CAACC,IAAI,CAACR,aAAa,CAACS,KAAK,CAACC,MAAK,GAAIN,YAAY,CAAC;IAC7D,CAAC,CAAC;;IAEF;IACA,MAAMO,YAAW,GAAIrB,QAAQ,CAAC,MAAM;MAClC,MAAMsB,KAAI,GAAI,CAACP,WAAW,CAACI,KAAI,GAAI,CAAC,IAAIL,YAAY;MACpD,MAAMS,GAAE,GAAID,KAAI,GAAIR,YAAY;MAChC,OAAOJ,aAAa,CAACS,KAAK,CAACK,KAAK,CAACF,KAAK,EAAEC,GAAG,CAAC;IAC9C,CAAC,CAAC;;IAEF;IACA,MAAME,UAAS,GAAIzB,QAAQ,CAAC,MAAM;MAChC,OAAO,CAACe,WAAW,CAACI,KAAI,GAAI,CAAC,IAAIL,YAAY;IAC/C,CAAC,CAAC;;IAEF;IACA,MAAMY,eAAc,GAAKC,KAAK,IAAK;MACjC,MAAMC,OAAM,GAAI;QACd,CAAC,EAAE,OAAO;QACV,CAAC,EAAE,OAAO;QACV,CAAC,EAAE,MAAM;QACT,CAAC,EAAE,MAAM;QACT,CAAC,EAAE;MACL,CAAC;MAED,OAAOA,OAAO,CAACD,KAAK,KAAK,EAAE;IAC7B,CAAC;;IAED;IACA,MAAME,eAAc,GAAI7B,QAAQ,CAAC,MAAM;MACrC,OAAOY,OAAO,CAACO,KAAK,CAACW,MAAM,CAACC,CAAA,IAAK,CAACA,CAAC,CAAC,CAACX,MAAM;IAC7C,CAAC,CAAC;;IAEF;IACA,MAAMY,sBAAqB,GAAIhC,QAAQ,CAAC,MAAM;MAC5C,OAAO6B,eAAe,CAACV,KAAI,GAAI,CAAC;IAClC,CAAC,CAAC;;IAEF;IACA,MAAMc,SAAQ,GAAIA,CAAA,KAAM;MACtBrB,OAAO,CAACO,KAAI,GAAI,IAAIe,KAAK,CAACxB,aAAa,CAACS,KAAK,CAACC,MAAM,CAAC,CAACe,IAAI,CAAC,IAAI,CAAC;IAClE,CAAC;;IAED;IACA,MAAMC,UAAS,GAAIA,CAAA,KAAM;MACvB,IAAIJ,sBAAsB,CAACb,KAAK,EAAE;QAChC;QACA,MAAMkB,oBAAmB,GAAIzB,OAAO,CAACO,KAAK,CAACmB,SAAS,CAACP,CAAA,IAAK,CAACA,CAAC,CAAC;QAC7D,IAAIM,oBAAmB,KAAM,CAAC,CAAC,EAAE;UAC/BtB,WAAW,CAACI,KAAI,GAAIF,IAAI,CAACsB,KAAK,CAACF,oBAAmB,GAAIvB,YAAY,IAAI,CAAC;QACzE;QACA;MACF;;MAEA;MACAD,SAAS,CAACM,KAAI,GAAI,IAAI;;MAEtB;MACAV,MAAM,CAAC+B,IAAI,CAAC;QAAElC,IAAI,EAAE;MAAc,CAAC,CAAC;IACtC,CAAC;;IAED;IACA,MAAMmC,iBAAgB,GAAI,MAAAA,CAAA,KAAY;MACpC,MAAMjC,KAAK,CAACkC,QAAQ,CAAC,oBAAoB,CAAC;;MAE1C;MACA,IAAI9B,OAAO,CAACO,KAAK,CAACC,MAAK,KAAM,CAAC,EAAE;QAC9BR,OAAO,CAACO,KAAI,GAAI,IAAIe,KAAK,CAACxB,aAAa,CAACS,KAAK,CAACC,MAAM,CAAC,CAACe,IAAI,CAAC,IAAI,CAAC;MAClE;IACF,CAAC;;IAED;IACAjC,SAAS,CAAC,MAAM;MACduC,iBAAiB,CAAC,CAAC;IACrB,CAAC,CAAC;IAEF,OAAO;MACL/B,aAAa;MACbE,OAAO;MACPC,SAAS;MACTE,WAAW;MACXC,UAAU;MACVK,YAAY;MACZI,UAAU;MACVI,eAAe;MACfG,sBAAsB;MACtBW,OAAO,EAAE3C,QAAQ,CAAC,MAAMQ,KAAK,CAACG,KAAK,CAACgC,OAAO,CAAC;MAC5CjB,eAAe;MACfO,SAAS;MACTG;IACF,CAAC;EACH;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}