{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, renderList as _renderList, Fragment as _Fragment, toDisplayString as _toDisplayString, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"self-rate\"\n};\nconst _hoisted_2 = {\n  key: 0,\n  class: \"text-center py-4\"\n};\nconst _hoisted_3 = {\n  class: \"text-center mt-4\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_v_icon = _resolveComponent(\"v-icon\");\n  const _component_v_card_title = _resolveComponent(\"v-card-title\");\n  const _component_v_progress_circular = _resolveComponent(\"v-progress-circular\");\n  const _component_v_radio = _resolveComponent(\"v-radio\");\n  const _component_v_radio_group = _resolveComponent(\"v-radio-group\");\n  const _component_v_table = _resolveComponent(\"v-table\");\n  const _component_v_pagination = _resolveComponent(\"v-pagination\");\n  const _component_v_alert = _resolveComponent(\"v-alert\");\n  const _component_v_card_text = _resolveComponent(\"v-card-text\");\n  const _component_v_divider = _resolveComponent(\"v-divider\");\n  const _component_v_btn = _resolveComponent(\"v-btn\");\n  const _component_v_spacer = _resolveComponent(\"v-spacer\");\n  const _component_v_card_actions = _resolveComponent(\"v-card-actions\");\n  const _component_v_card = _resolveComponent(\"v-card\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_v_card, null, {\n    default: _withCtx(() => [_createVNode(_component_v_card_title, {\n      class: \"text-h5 primary--text\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_v_icon, {\n        start: \"\",\n        icon: \"mdi-checkbox-marked-circle-outline\"\n      }), _cache[1] || (_cache[1] = _createTextVNode(\" 英语阅读能力自评 \"))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_v_card_text, null, {\n      default: _withCtx(() => [_cache[5] || (_cache[5] = _createElementVNode(\"p\", {\n        class: \"text-body-1 mb-4\"\n      }, \" 请根据您的实际情况，为每项描述选择最符合的选项。您的选择将帮助我们更好地了解您的英语阅读水平和需求。 \", -1 /* HOISTED */)), $setup.selfRateItems.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_2, [_createVNode(_component_v_progress_circular, {\n        indeterminate: \"\",\n        color: \"primary\"\n      }), _cache[2] || (_cache[2] = _createElementVNode(\"div\", {\n        class: \"mt-2\"\n      }, \"加载中...\", -1 /* HOISTED */))])) : (_openBlock(), _createElementBlock(_Fragment, {\n        key: 1\n      }, [_createVNode(_component_v_table, null, {\n        default: _withCtx(() => [_createElementVNode(\"thead\", null, [_createElementVNode(\"tr\", null, [_cache[3] || (_cache[3] = _createElementVNode(\"th\", null, \"序号\", -1 /* HOISTED */)), _cache[4] || (_cache[4] = _createElementVNode(\"th\", null, \"描述\", -1 /* HOISTED */)), (_openBlock(), _createElementBlock(_Fragment, null, _renderList(5, i => {\n          return _createElementVNode(\"th\", {\n            class: \"text-center\",\n            key: `header-${i}`\n          }, _toDisplayString($setup.getColumnHeader(i)), 1 /* TEXT */);\n        }), 64 /* STABLE_FRAGMENT */))])]), _createElementVNode(\"tbody\", null, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.currentItems, (item, index) => {\n          return _openBlock(), _createElementBlock(\"tr\", {\n            key: `item-${item.id}`\n          }, [_createElementVNode(\"td\", null, _toDisplayString($setup.startIndex + index + 1), 1 /* TEXT */), _createElementVNode(\"td\", null, _toDisplayString(item.内容), 1 /* TEXT */), (_openBlock(), _createElementBlock(_Fragment, null, _renderList(5, i => {\n            return _createElementVNode(\"td\", {\n              class: \"text-center\",\n              key: `option-${i}`\n            }, [_createVNode(_component_v_radio_group, {\n              modelValue: $setup.answers[$setup.startIndex + index],\n              \"onUpdate:modelValue\": $event => $setup.answers[$setup.startIndex + index] = $event,\n              inline: \"\",\n              \"hide-details\": \"\",\n              class: \"ma-0 pa-0 justify-center\"\n            }, {\n              default: _withCtx(() => [_createVNode(_component_v_radio, {\n                value: i,\n                disabled: $setup.completed\n              }, null, 8 /* PROPS */, [\"value\", \"disabled\"])]),\n              _: 2 /* DYNAMIC */\n            }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"modelValue\", \"onUpdate:modelValue\"])]);\n          }), 64 /* STABLE_FRAGMENT */))]);\n        }), 128 /* KEYED_FRAGMENT */))])]),\n        _: 1 /* STABLE */\n      }), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_v_pagination, {\n        modelValue: $setup.currentPage,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.currentPage = $event),\n        length: $setup.totalPages,\n        \"total-visible\": 7\n      }, null, 8 /* PROPS */, [\"modelValue\", \"length\"])]), $setup.hasUnansweredQuestions ? (_openBlock(), _createBlock(_component_v_alert, {\n        key: 0,\n        type: \"warning\",\n        variant: \"tonal\",\n        border: \"start\",\n        icon: \"mdi-alert-outline\",\n        class: \"mt-4\"\n      }, {\n        default: _withCtx(() => [_createTextVNode(\" 您还有 \" + _toDisplayString($setup.unansweredCount) + \" 个项目未评估。请确保所有项目都已选择后再继续。 \", 1 /* TEXT */)]),\n        _: 1 /* STABLE */\n      })) : _createCommentVNode(\"v-if\", true)], 64 /* STABLE_FRAGMENT */))]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_v_divider), _createVNode(_component_v_card_actions, null, {\n      default: _withCtx(() => [!$setup.completed ? (_openBlock(), _createBlock(_component_v_btn, {\n        key: 0,\n        variant: \"outlined\",\n        color: \"error\",\n        onClick: $setup.resetForm\n      }, {\n        default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\" 重置 \")])),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\"])) : _createCommentVNode(\"v-if\", true), _createVNode(_component_v_spacer), _createVNode(_component_v_btn, {\n        color: \"primary\",\n        variant: \"flat\",\n        disabled: $setup.hasUnansweredQuestions,\n        loading: $setup.loading,\n        onClick: $setup.submitForm\n      }, {\n        default: _withCtx(() => [_cache[7] || (_cache[7] = _createTextVNode(\" 继续 \")), _createVNode(_component_v_icon, {\n          end: \"\",\n          icon: \"mdi-arrow-right\"\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"disabled\", \"loading\", \"onClick\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createVNode","_component_v_card","default","_withCtx","_component_v_card_title","_component_v_icon","start","icon","_createTextVNode","_","_component_v_card_text","_createElementVNode","$setup","selfRateItems","length","_hoisted_2","_component_v_progress_circular","indeterminate","color","_Fragment","_component_v_table","_renderList","i","getColumnHeader","currentItems","item","index","id","_toDisplayString","startIndex","内容","_component_v_radio_group","modelValue","answers","$event","inline","_component_v_radio","value","disabled","completed","_hoisted_3","_component_v_pagination","currentPage","_cache","totalPages","hasUnansweredQuestions","_createBlock","_component_v_alert","type","variant","border","unansweredCount","_createCommentVNode","_component_v_divider","_component_v_card_actions","_component_v_btn","onClick","resetForm","_component_v_spacer","loading","submitForm","end"],"sources":["D:\\PycharmProjects\\perss_v4\\frontend\\src\\views\\planning\\SelfRate.vue"],"sourcesContent":["<template>\r\n  <div class=\"self-rate\">\r\n    <v-card>\r\n      <v-card-title class=\"text-h5 primary--text\">\r\n        <v-icon start icon=\"mdi-checkbox-marked-circle-outline\"></v-icon>\r\n        英语阅读能力自评\r\n      </v-card-title>\r\n\r\n      <v-card-text>\r\n        <p class=\"text-body-1 mb-4\">\r\n          请根据您的实际情况，为每项描述选择最符合的选项。您的选择将帮助我们更好地了解您的英语阅读水平和需求。\r\n        </p>\r\n\r\n        <div v-if=\"selfRateItems.length === 0\" class=\"text-center py-4\">\r\n          <v-progress-circular indeterminate color=\"primary\"></v-progress-circular>\r\n          <div class=\"mt-2\">加载中...</div>\r\n        </div>\r\n\r\n        <template v-else>\r\n          <v-table>\r\n            <thead>\r\n              <tr>\r\n                <th>序号</th>\r\n                <th>描述</th>\r\n                <th class=\"text-center\" v-for=\"i in 5\" :key=\"`header-${i}`\">\r\n                  {{ getColumnHeader(i) }}\r\n                </th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr v-for=\"(item, index) in currentItems\" :key=\"`item-${item.id}`\">\r\n                <td>{{ startIndex + index + 1 }}</td>\r\n                <td>{{ item.内容 }}</td>\r\n                <td class=\"text-center\" v-for=\"i in 5\" :key=\"`option-${i}`\">\r\n                  <v-radio-group\r\n                    v-model=\"answers[startIndex + index]\"\r\n                    inline\r\n                    hide-details\r\n                    class=\"ma-0 pa-0 justify-center\"\r\n                  >\r\n                    <v-radio :value=\"i\" :disabled=\"completed\"></v-radio>\r\n                  </v-radio-group>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </v-table>\r\n\r\n          <div class=\"text-center mt-4\">\r\n            <v-pagination\r\n              v-model=\"currentPage\"\r\n              :length=\"totalPages\"\r\n              :total-visible=\"7\"\r\n            ></v-pagination>\r\n          </div>\r\n\r\n          <v-alert\r\n            v-if=\"hasUnansweredQuestions\"\r\n            type=\"warning\"\r\n            variant=\"tonal\"\r\n            border=\"start\"\r\n            icon=\"mdi-alert-outline\"\r\n            class=\"mt-4\"\r\n          >\r\n            您还有 {{ unansweredCount }} 个项目未评估。请确保所有项目都已选择后再继续。\r\n          </v-alert>\r\n        </template>\r\n      </v-card-text>\r\n\r\n      <v-divider></v-divider>\r\n\r\n      <v-card-actions>\r\n        <v-btn\r\n          v-if=\"!completed\"\r\n          variant=\"outlined\"\r\n          color=\"error\"\r\n          @click=\"resetForm\"\r\n        >\r\n          重置\r\n        </v-btn>\r\n\r\n        <v-spacer></v-spacer>\r\n\r\n        <v-btn\r\n          color=\"primary\"\r\n          variant=\"flat\"\r\n          :disabled=\"hasUnansweredQuestions\"\r\n          :loading=\"loading\"\r\n          @click=\"submitForm\"\r\n        >\r\n          继续\r\n          <v-icon end icon=\"mdi-arrow-right\"></v-icon>\r\n        </v-btn>\r\n      </v-card-actions>\r\n    </v-card>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { computed, ref, onMounted, watch } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useRouter } from 'vue-router';\r\n\r\nexport default {\r\n  name: 'SelfRate',\r\n\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n\r\n    // 自评量表数据\r\n    const selfRateItems = computed(() => store.state.selfRateItems);\r\n    const answers = ref([]);\r\n    const completed = ref(false);\r\n\r\n    // 分页\r\n    const itemsPerPage = 10;\r\n    const currentPage = ref(1);\r\n\r\n    // 计算总页数\r\n    const totalPages = computed(() => {\r\n      return Math.ceil(selfRateItems.value.length / itemsPerPage);\r\n    });\r\n\r\n    // 计算当前页的项目\r\n    const currentItems = computed(() => {\r\n      const start = (currentPage.value - 1) * itemsPerPage;\r\n      const end = start + itemsPerPage;\r\n      return selfRateItems.value.slice(start, end);\r\n    });\r\n\r\n    // 当前页起始索引\r\n    const startIndex = computed(() => {\r\n      return (currentPage.value - 1) * itemsPerPage;\r\n    });\r\n\r\n    // 获取列标题\r\n    const getColumnHeader = (index) => {\r\n      const headers = {\r\n        1: '完全不符合',\r\n        2: '有些不符合',\r\n        3: '有些符合',\r\n        4: '比较符合',\r\n        5: '非常符合'\r\n      };\r\n\r\n      return headers[index] || '';\r\n    };\r\n\r\n    // 计算未回答的问题数量\r\n    const unansweredCount = computed(() => {\r\n      return answers.value.filter(a => !a).length;\r\n    });\r\n\r\n    // 是否有未回答的问题\r\n    const hasUnansweredQuestions = computed(() => {\r\n      return unansweredCount.value > 0;\r\n    });\r\n\r\n    // 重置表单\r\n    const resetForm = () => {\r\n      answers.value = new Array(selfRateItems.value.length).fill(null);\r\n    };\r\n\r\n    // 提交表单\r\n    const submitForm = () => {\r\n      if (hasUnansweredQuestions.value) {\r\n        // 如果有未回答的问题，切换到第一个未回答的问题所在页\r\n        const firstUnansweredIndex = answers.value.findIndex(a => !a);\r\n        if (firstUnansweredIndex !== -1) {\r\n          currentPage.value = Math.floor(firstUnansweredIndex / itemsPerPage) + 1;\r\n        }\r\n        return;\r\n      }\r\n\r\n      // 标记为已完成\r\n      completed.value = true;\r\n\r\n      // 导航到用户画像页面\r\n      router.push({ name: 'UserProfile' });\r\n    };\r\n\r\n    // 加载自评量表\r\n    const loadSelfRateItems = async () => {\r\n      await store.dispatch('fetchSelfRateItems');\r\n\r\n      // 初始化答案数组\r\n      if (answers.value.length === 0) {\r\n        answers.value = new Array(selfRateItems.value.length).fill(null);\r\n      }\r\n    };\r\n\r\n    // 组件挂载时加载数据\r\n    onMounted(() => {\r\n      loadSelfRateItems();\r\n    });\r\n\r\n    return {\r\n      selfRateItems,\r\n      answers,\r\n      completed,\r\n      currentPage,\r\n      totalPages,\r\n      currentItems,\r\n      startIndex,\r\n      unansweredCount,\r\n      hasUnansweredQuestions,\r\n      loading: computed(() => store.state.loading),\r\n      getColumnHeader,\r\n      resetForm,\r\n      submitForm\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.self-rate {\r\n  max-width: 100%;\r\n}\r\n\r\n.v-table {\r\n  border: 1px solid #e0e0e0;\r\n}\r\n\r\n.v-table th, .v-table td {\r\n  padding: 8px;\r\n  vertical-align: middle;\r\n}\r\n\r\n.v-table th:nth-child(2), .v-table td:nth-child(2) {\r\n  text-align: left;\r\n  min-width: 300px;\r\n}\r\n\r\n.v-table th:not(:nth-child(2)), .v-table td:not(:nth-child(2)) {\r\n  width: 80px;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}