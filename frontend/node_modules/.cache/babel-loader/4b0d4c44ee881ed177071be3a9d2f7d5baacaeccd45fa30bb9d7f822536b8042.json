{"ast":null,"code":"import { ref, computed, onMounted } from 'vue';\nimport { useStore } from 'vuex';\nimport { useRouter } from 'vue-router';\nimport { marked } from 'marked';\nexport default {\n  name: 'Summary',\n  setup() {\n    const store = useStore();\n    const router = useRouter();\n\n    // 用户信息\n    const userProfile = computed(() => store.state.userProfile || {});\n\n    // 学习总结\n    const finalSummary = computed(() => store.state.finalSummary);\n    const loading = computed(() => store.state.loading);\n\n    // 重启确认对话框\n    const confirmRestartDialog = ref(false);\n\n    // 格式化总结内容\n    const formattedSummary = computed(() => {\n      return finalSummary.value ? marked(finalSummary.value) : '';\n    });\n\n    // 加载学习总结\n    const loadFinalSummary = async () => {\n      // 确保已获取用户信息\n      if (!userProfile.value.name) {\n        await store.dispatch('fetchUserProfile');\n      }\n      await store.dispatch('fetchFinalSummary');\n    };\n\n    // 计算提高百分比\n    const calculateImprovement = type => {\n      if (type === 'score') {\n        const preScore = parseInt(userProfile.value.post_score) || 0;\n        const postScore = parseInt(userProfile.value.after_score) || 0;\n        if (preScore === 0) return 0;\n        return (postScore - preScore) / preScore * 100;\n      } else {\n        const preScore = parseInt(userProfile.value.post_strategies_score) || 0;\n        const postScore = parseInt(userProfile.value.after_strategies_score) || 0;\n        if (preScore === 0) return 0;\n        return (postScore - preScore) / preScore * 100;\n      }\n    };\n\n    // 获取阅读水平\n    const getScoreLevel = score => {\n      if (score < 60) return '初级';\n      if (score < 80) return '中级';\n      return '高级';\n    };\n\n    // 获取策略水平\n    const getStrategyLevel = score => {\n      if (score <= 25) return '初级';\n      if (score <= 50) return '中级';\n      return '高级';\n    };\n\n    // 获取水平对应的颜色\n    const getLevelColor = level => {\n      if (level === '初级') return 'warning';\n      if (level === '中级') return 'info';\n      return 'success';\n    };\n\n    // 重启系统\n    const restartSystem = () => {\n      confirmRestartDialog.value = true;\n    };\n\n    // 确认重启\n    const confirmRestart = () => {\n      // 保留用户名，但清除其他状态\n      const userName = store.state.userName;\n\n      // 重置阶段\n      store.dispatch('setCurrentPhase', 'planning');\n\n      // 清除缓存的状态\n      store.commit('SET_PROFILE_ANALYSIS', '');\n      store.commit('SET_WRONG_ANSWERS_ANALYSIS', '');\n      store.commit('SET_STRATEGY_SUGGESTIONS', '');\n      confirmRestartDialog.value = false;\n\n      // 跳转到系统介绍页\n      router.push({\n        name: 'Introduction'\n      });\n    };\n\n    // 组件挂载时，获取用户信息和学习总结\n    onMounted(async () => {\n      await store.dispatch('fetchUserProfile');\n\n      // 如果有学习总结，直接显示\n      if (!finalSummary.value) {\n        // 检查是否已完成后测\n        if (userProfile.value.after_score && userProfile.value.after_strategies_score) {\n          loadFinalSummary();\n        }\n      }\n    });\n    return {\n      userProfile,\n      finalSummary,\n      loading,\n      formattedSummary,\n      confirmRestartDialog,\n      loadFinalSummary,\n      calculateImprovement,\n      getScoreLevel,\n      getStrategyLevel,\n      getLevelColor,\n      restartSystem,\n      confirmRestart\n    };\n  }\n};","map":{"version":3,"names":["ref","computed","onMounted","useStore","useRouter","marked","name","setup","store","router","userProfile","state","finalSummary","loading","confirmRestartDialog","formattedSummary","value","loadFinalSummary","dispatch","calculateImprovement","type","preScore","parseInt","post_score","postScore","after_score","post_strategies_score","after_strategies_score","getScoreLevel","score","getStrategyLevel","getLevelColor","level","restartSystem","confirmRestart","userName","commit","push"],"sources":["D:\\PycharmProjects\\perss_v4\\frontend\\src\\views\\feedback\\Summary.vue"],"sourcesContent":["<template>\r\n  <div class=\"summary\">\r\n    <v-card>\r\n      <v-card-title class=\"text-h5 primary--text\">\r\n        <v-icon start icon=\"mdi-chart-bar\"></v-icon>\r\n        学习总结与反馈\r\n      </v-card-title>\r\n\r\n      <v-card-text>\r\n        <v-alert\r\n          v-if=\"!finalSummary && !loading\"\r\n          type=\"info\"\r\n          variant=\"tonal\"\r\n          border=\"start\"\r\n        >\r\n          正在生成您的学习总结，请点击下方按钮获取。\r\n          <v-btn\r\n            variant=\"text\"\r\n            color=\"primary\"\r\n            @click=\"loadFinalSummary\"\r\n            class=\"mt-2\"\r\n          >\r\n            生成总结\r\n          </v-btn>\r\n        </v-alert>\r\n\r\n        <v-skeleton-loader\r\n          v-else-if=\"loading\"\r\n          type=\"article,table\"\r\n        ></v-skeleton-loader>\r\n\r\n        <template v-else-if=\"finalSummary\">\r\n          <div class=\"summary-content\">\r\n            <div v-html=\"formattedSummary\"></div>\r\n          </div>\r\n\r\n          <v-divider class=\"my-4\"></v-divider>\r\n\r\n          <v-row>\r\n            <v-col cols=\"12\" md=\"6\">\r\n              <v-card variant=\"outlined\" class=\"score-card\">\r\n                <v-card-title class=\"text-h6\">\r\n                  <v-icon start icon=\"mdi-file-document-outline\"></v-icon>\r\n                  阅读测试成绩\r\n                </v-card-title>\r\n                <v-card-text>\r\n                  <v-row align=\"center\">\r\n                    <v-col cols=\"6\">\r\n                      <h4 class=\"text-subtitle-2\">前测分数</h4>\r\n                      <div class=\"text-h4\">{{ userProfile.post_score || 0 }}<span class=\"text-subtitle-1\">/100</span></div>\r\n                    </v-col>\r\n                    <v-col cols=\"6\">\r\n                      <h4 class=\"text-subtitle-2\">后测分数</h4>\r\n                      <div class=\"text-h4\">{{ userProfile.after_score || 0 }}<span class=\"text-subtitle-1\">/100</span></div>\r\n                    </v-col>\r\n                  </v-row>\r\n\r\n                  <v-progress-linear\r\n                    :model-value=\"calculateImprovement('score')\"\r\n                    color=\"success\"\r\n                    height=\"20\"\r\n                    striped\r\n                    class=\"mt-4\"\r\n                  >\r\n                    <template v-slot:default=\"{ value }\">\r\n                      <span>提高了 {{ Math.round(value) }}%</span>\r\n                    </template>\r\n                  </v-progress-linear>\r\n                </v-card-text>\r\n              </v-card>\r\n            </v-col>\r\n\r\n            <v-col cols=\"12\" md=\"6\">\r\n              <v-card variant=\"outlined\" class=\"score-card\">\r\n                <v-card-title class=\"text-h6\">\r\n                  <v-icon start icon=\"mdi-clipboard-list-outline\"></v-icon>\r\n                  阅读策略水平\r\n                </v-card-title>\r\n                <v-card-text>\r\n                  <v-row align=\"center\">\r\n                    <v-col cols=\"6\">\r\n                      <h4 class=\"text-subtitle-2\">前测分数</h4>\r\n                      <div class=\"text-h4\">{{ userProfile.post_strategies_score || 0 }}<span class=\"text-subtitle-1\">/75</span></div>\r\n                    </v-col>\r\n                    <v-col cols=\"6\">\r\n                      <h4 class=\"text-subtitle-2\">后测分数</h4>\r\n                      <div class=\"text-h4\">{{ userProfile.after_strategies_score || 0 }}<span class=\"text-subtitle-1\">/75</span></div>\r\n                    </v-col>\r\n                  </v-row>\r\n\r\n                  <v-progress-linear\r\n                    :model-value=\"calculateImprovement('strategy')\"\r\n                    color=\"info\"\r\n                    height=\"20\"\r\n                    striped\r\n                    class=\"mt-4\"\r\n                  >\r\n                    <template v-slot:default=\"{ value }\">\r\n                      <span>提高了 {{ Math.round(value) }}%</span>\r\n                    </template>\r\n                  </v-progress-linear>\r\n                </v-card-text>\r\n              </v-card>\r\n            </v-col>\r\n          </v-row>\r\n\r\n          <v-card variant=\"outlined\" class=\"mt-4\">\r\n            <v-card-title class=\"text-h6\">\r\n              <v-icon start icon=\"mdi-certificate-outline\"></v-icon>\r\n              英语阅读水平评定\r\n            </v-card-title>\r\n            <v-card-text>\r\n              <v-row>\r\n                <v-col cols=\"12\" md=\"4\">\r\n                  <v-card variant=\"flat\" class=\"text-center pa-4\">\r\n                    <h4 class=\"text-subtitle-2\">前测水平</h4>\r\n                    <v-chip\r\n                      size=\"large\"\r\n                      :color=\"getLevelColor(getScoreLevel(userProfile.post_score || 0))\"\r\n                      class=\"mt-2\"\r\n                    >\r\n                      {{ getScoreLevel(userProfile.post_score || 0) }}\r\n                    </v-chip>\r\n                  </v-card>\r\n                </v-col>\r\n\r\n                <v-col cols=\"12\" md=\"4\">\r\n                  <v-card variant=\"flat\" class=\"text-center pa-4\">\r\n                    <h4 class=\"text-subtitle-2\">后测水平</h4>\r\n                    <v-chip\r\n                      size=\"large\"\r\n                      :color=\"getLevelColor(getScoreLevel(userProfile.after_score || 0))\"\r\n                      class=\"mt-2\"\r\n                    >\r\n                      {{ getScoreLevel(userProfile.after_score || 0) }}\r\n                    </v-chip>\r\n                  </v-card>\r\n                </v-col>\r\n\r\n                <v-col cols=\"12\" md=\"4\">\r\n                  <v-card variant=\"flat\" class=\"text-center pa-4\">\r\n                    <h4 class=\"text-subtitle-2\">策略掌握水平</h4>\r\n                    <v-chip\r\n                      size=\"large\"\r\n                      :color=\"getLevelColor(getStrategyLevel(userProfile.after_strategies_score || 0))\"\r\n                      class=\"mt-2\"\r\n                    >\r\n                      {{ getStrategyLevel(userProfile.after_strategies_score || 0) }}\r\n                    </v-chip>\r\n                  </v-card>\r\n                </v-col>\r\n              </v-row>\r\n            </v-card-text>\r\n          </v-card>\r\n        </template>\r\n      </v-card-text>\r\n\r\n      <v-divider></v-divider>\r\n\r\n      <v-card-actions>\r\n        <v-btn\r\n          color=\"error\"\r\n          variant=\"text\"\r\n          @click=\"restartSystem\"\r\n        >\r\n          <v-icon start icon=\"mdi-restart\"></v-icon>\r\n          重新开始\r\n        </v-btn>\r\n\r\n        <v-spacer></v-spacer>\r\n\r\n        <v-btn\r\n          v-if=\"finalSummary\"\r\n          color=\"primary\"\r\n          variant=\"flat\"\r\n        >\r\n          完成学习\r\n          <v-icon end icon=\"mdi-check\"></v-icon>\r\n        </v-btn>\r\n      </v-card-actions>\r\n    </v-card>\r\n\r\n    <!-- 重启确认对话框 -->\r\n    <v-dialog v-model=\"confirmRestartDialog\" max-width=\"400\">\r\n      <v-card>\r\n        <v-card-title>确认重新开始</v-card-title>\r\n        <v-card-text>\r\n          您确定要重新开始整个学习过程吗？此操作将清除您的学习进度，但保留您的用户信息和成绩记录。\r\n        </v-card-text>\r\n        <v-card-actions>\r\n          <v-spacer></v-spacer>\r\n          <v-btn variant=\"text\" @click=\"confirmRestartDialog = false\">取消</v-btn>\r\n          <v-btn color=\"error\" @click=\"confirmRestart\">确认</v-btn>\r\n        </v-card-actions>\r\n      </v-card>\r\n    </v-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { ref, computed, onMounted } from 'vue';\r\nimport { useStore } from 'vuex';\r\nimport { useRouter } from 'vue-router';\r\nimport { marked } from 'marked';\r\n\r\nexport default {\r\n  name: 'Summary',\r\n\r\n  setup() {\r\n    const store = useStore();\r\n    const router = useRouter();\r\n\r\n    // 用户信息\r\n    const userProfile = computed(() => store.state.userProfile || {});\r\n\r\n    // 学习总结\r\n    const finalSummary = computed(() => store.state.finalSummary);\r\n    const loading = computed(() => store.state.loading);\r\n\r\n    // 重启确认对话框\r\n    const confirmRestartDialog = ref(false);\r\n\r\n    // 格式化总结内容\r\n    const formattedSummary = computed(() => {\r\n      return finalSummary.value ? marked(finalSummary.value) : '';\r\n    });\r\n\r\n    // 加载学习总结\r\n    const loadFinalSummary = async () => {\r\n      // 确保已获取用户信息\r\n      if (!userProfile.value.name) {\r\n        await store.dispatch('fetchUserProfile');\r\n      }\r\n\r\n      await store.dispatch('fetchFinalSummary');\r\n    };\r\n\r\n    // 计算提高百分比\r\n    const calculateImprovement = (type) => {\r\n      if (type === 'score') {\r\n        const preScore = parseInt(userProfile.value.post_score) || 0;\r\n        const postScore = parseInt(userProfile.value.after_score) || 0;\r\n\r\n        if (preScore === 0) return 0;\r\n        return ((postScore - preScore) / preScore) * 100;\r\n      } else {\r\n        const preScore = parseInt(userProfile.value.post_strategies_score) || 0;\r\n        const postScore = parseInt(userProfile.value.after_strategies_score) || 0;\r\n\r\n        if (preScore === 0) return 0;\r\n        return ((postScore - preScore) / preScore) * 100;\r\n      }\r\n    };\r\n\r\n    // 获取阅读水平\r\n    const getScoreLevel = (score) => {\r\n      if (score < 60) return '初级';\r\n      if (score < 80) return '中级';\r\n      return '高级';\r\n    };\r\n\r\n    // 获取策略水平\r\n    const getStrategyLevel = (score) => {\r\n      if (score <= 25) return '初级';\r\n      if (score <= 50) return '中级';\r\n      return '高级';\r\n    };\r\n\r\n    // 获取水平对应的颜色\r\n    const getLevelColor = (level) => {\r\n      if (level === '初级') return 'warning';\r\n      if (level === '中级') return 'info';\r\n      return 'success';\r\n    };\r\n\r\n    // 重启系统\r\n    const restartSystem = () => {\r\n      confirmRestartDialog.value = true;\r\n    };\r\n\r\n    // 确认重启\r\n    const confirmRestart = () => {\r\n      // 保留用户名，但清除其他状态\r\n      const userName = store.state.userName;\r\n\r\n      // 重置阶段\r\n      store.dispatch('setCurrentPhase', 'planning');\r\n\r\n      // 清除缓存的状态\r\n      store.commit('SET_PROFILE_ANALYSIS', '');\r\n      store.commit('SET_WRONG_ANSWERS_ANALYSIS', '');\r\n      store.commit('SET_STRATEGY_SUGGESTIONS', '');\r\n\r\n      confirmRestartDialog.value = false;\r\n\r\n      // 跳转到系统介绍页\r\n      router.push({ name: 'Introduction' });\r\n    };\r\n\r\n    // 组件挂载时，获取用户信息和学习总结\r\n    onMounted(async () => {\r\n      await store.dispatch('fetchUserProfile');\r\n\r\n      // 如果有学习总结，直接显示\r\n      if (!finalSummary.value) {\r\n        // 检查是否已完成后测\r\n        if (userProfile.value.after_score && userProfile.value.after_strategies_score) {\r\n          loadFinalSummary();\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      userProfile,\r\n      finalSummary,\r\n      loading,\r\n      formattedSummary,\r\n      confirmRestartDialog,\r\n      loadFinalSummary,\r\n      calculateImprovement,\r\n      getScoreLevel,\r\n      getStrategyLevel,\r\n      getLevelColor,\r\n      restartSystem,\r\n      confirmRestart\r\n    };\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.summary {\r\n  max-width: 100%;\r\n}\r\n\r\n.summary-content {\r\n  background-color: #f8f9fa;\r\n  padding: 16px;\r\n  border-radius: 8px;\r\n  margin-bottom: 24px;\r\n  max-height: 400px;\r\n  overflow-y: auto;\r\n}\r\n\r\n.score-card {\r\n  height: 100%;\r\n}\r\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}